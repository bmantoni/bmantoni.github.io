<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Welcome to the Neo-HPSTR Blog &#8211; Counting to Infinity</title>
<meta name="description" content="Describe this nonsense.">
<meta name="keywords" content="Jekyll, theme, themes, responsive, blog, modern">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/images/logo.png">
<meta name="twitter:title" content="Welcome to the Neo-HPSTR Blog">
<meta name="twitter:description" content="Describe this nonsense.">
<meta name="twitter:creator" content="@aron_bordin">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Welcome to the Neo-HPSTR Blog">
<meta property="og:description" content="Describe this nonsense.">
<meta property="og:url" content="/index.html">
<meta property="og:site_name" content="Counting to Infinity">





<link rel="canonical" href="/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Counting to Infinity Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/jquery.mmenu.all.css">
<link rel="stylesheet" href="/assets/css/jquery.floating-social-share.min.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->



<div class="entry-header">
  <div class="header-menu header-menu-top">
    <ul>
      <li class="header-item-title header-toggle "><a href="#menu"><h2><i class="fa fa-bars"></i></h2></a></li>
      <li class="header-item-title">
        <a href="/">
          
            <img class="logo" src="/images/logo.png" alt="Counting to Infinity">
          
          <h2 class="title"> Counting to Infinity</h2>
        </a>
      </li>
      
        
        

        
          <li class="header-item "><a href="#"><h3>Favorites</h3></a>
            <ul class="header-submenu">
              
                <li class="sub-item"><a href="/code-highlighting-post/">highlighter</a></li>
              
                <li class="sub-item"><a href="/readability-post/">intro</a></li>
              
            </ul>
          </li>
        
      
        
        

        
          <li class="header-item "><a href="/categories"><h3>Categories</h3></a>
            <ul class="header-submenu">
              
                
                  <li class="sub-item"><a href="/categories/#blog">blog</a></li>
              
            </ul>
          </li>
        
      
        
        

        
          <li class="header-item "><a href="/tags"><h3>Tags</h3></a></li>
        
      
        
        

        
          <li class="header-item "><a href="/about"><h3>About</h3></a></li>
        
      
        
        
          
        

        
          <li class="header-item active"><a href="/"><h3>Home</h3></a></li>
        
      
      <li class="header-item"><a href="/search"><h3><i class="fa fa-search"></i></h3></a></li>
    </ul>
  </div>
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Welcome to the Neo-HPSTR Blog</h1>
      

      
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->


<nav id="menu" style="display: none">
  <ul>
    
      
        <li><a href="/"><h3>Home</h3></a></li>
      
    
      
        <li><a href="/about"><h3>About</h3></a></li>
      
    
      
        <li><a href="/tags"><h3>Tags</h3></a></li>
      
    
      
        <li><a href="/categories"><h3>Categories</h3></a>
          <ul>
            
              
                <li><a href="/categories/#blog">blog</a></li>
            
          </ul>
        </li>
      
    
      
        <li><a href="#"><h3>Favorites</h3></a>
          <ul>
            
              <li><a href="/code-highlighting-post/">highlighter</a></li>
            
              <li><a href="/readability-post/">intro</a></li>
            
          </ul>
        </li>
      
    
  </ul>
</nav>


  <a href="https://twitter.com/aron_bordin" class="btn btn-info button-twitter" data-show-count="false" data-size="large"><i class="fa fa-twitter"></i> <span> | Follow @aron_bordin</span></a>



<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-10-16T00:00:00-04:00"><a href="/using-jq-with-curl-on-cygwin/">October 16, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Bobby M">Bobby M</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/using-jq-with-curl-on-cygwin/" rel="bookmark" title="Using jq with curl on Cygwin" itemprop="url">Using jq with curl on Cygwin</a></h1>
    
  </header>
  <div class="entry-content">
    
      <h2 id="parsing-json-from-http-requests-with-curl-using-jq-in-cygwin">Parsing JSON from HTTP requests with curl, using jq, in Cygwin</h2>

<p>Sometimes you’re just not on a Mac or Linux machine and need to work with JSON.</p>

<p>jq is a great tool, and if I was on my Mac and wanted to parse some JSON, retrieving it with an HTTP request, I’d just do:</p>

<div>
  <pre><code class="bash">curl 'https://api.github.com/repos/stedolan/jq/commits?per_page=5' | jq '.'</code></pre>
</div>

<p>But on Windows, after downloading jq-win64.exe and adding it to my PATH, if I just try to pipe it, it’s not happy:</p>

<div>
  <pre><code class="bash">curl 'https://api.github.com/repos/stedolan/jq/commits?per_page=5' | jq-win64.exe '.'</code></pre>
</div>

<p>curl gets the content, but it bombs.</p>

<p>So, I just wrap the .exe in a sh script named jq, with this content:</p>

<div>
  <pre><code class="bash">#!/bin/bash
jq-win64.exe --color-output &quot;$@&quot;</code></pre>
</div>

<p>And now it works!</p>

<div>
  <pre><code class="bash">$ curl -sS 'https://api.github.com/repos/stedolan/jq/commits?per_page=5' | jq '.[0].commit.message'
&quot;Revert \&quot;Adjust spacing of section headers to account for nav bar (fix #986)\&quot;\n\nThis reverts commit 73b8413d10751c7be3e54d83ea338b3e895bdda3.\n\nThe fix for #986 caused #988.&quot;</code></pre>
</div>


    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-10-16T00:00:00-04:00"><a href="/taking-a-dump/">October 16, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Bobby M">Bobby M</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/taking-a-dump/" rel="bookmark" title="Taking a dump" itemprop="url">Taking a dump</a></h1>
    
  </header>
  <div class="entry-content">
    
      <h2 id="simple-example-of-taking-a-heap-dump-and-analyzing-it">Simple example of taking a (heap) dump and analyzing it</h2>

<p>I just wanted to prove that I can take a dump, and see something meaningful in it. To do this I wrote a simple program that creates an obvious memory usage pattern that should be dead-simple to see in the dump.</p>

<p>Compile and run the following code. It will intentionally create an array with many Integers. </p>

<div>
  <pre><code class="java">public class DumpTest
{
	public static void main(String[] args) throws Exception
	{	
		final Integer NUM_FACTS = 100000;
		Foo[] x = new Foo[NUM_FACTS];
		
		for(int i = 0; i &lt; NUM_FACTS; i++)
			x[i] = new DumpTest().new Foo();
		
		System.out.println(&quot;Populated array with &quot; + NUM_FACTS.toString() + &quot;. Waiting 10 seconds...&quot;);
		Thread.sleep(256000);
		System.out.println(&quot;Done.&quot;);
	}
	
	public class Foo
	{
		public int x;
	}
}</code></pre>
</div>

<p>The code conveniently waits after it has created all these objects, so we can take the dump while it’s waiting:</p>

<div>
  <pre><code class="bash">jmap -dump:format=b,file=heap.bin 8216</code></pre>
</div>

<p>Open it up in VisualVM, and there we have it - many, many Integers.</p>

    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-08-27T00:00:00-04:00"><a href="/motion-activated-philips-hue-with-raspberry-pi/">August 27, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Bobby M">Bobby M</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/motion-activated-philips-hue-with-raspberry-pi/" rel="bookmark" title="Motion Activated Philips Hue with Raspberry Pi" itemprop="url">Motion Activated Philips Hue with Raspberry Pi</a></h1>
    
  </header>
  <div class="entry-content">
    
      <h2 id="controlling-hue-lights-with-a-pi-and-python-over-wifi">Controlling Hue lights with a Pi and Python over wifi</h2>

<p><img src="media/intro3.jpg" alt="intro3.jpg" /></p>

<p><strong>TODO - embed youtube video</strong> </p>

<p>I finally found an excuse to go out and buy a Hue kit when my first baby arrived. I want the nursery to offer a range of interesting sensory stimuli for his little developing mind, especially visual and auditory. A Bluetooth speaker and Spotify handle the latter easily enough, and this clever technology from Philips - with it’s beautiful range of saturated, luminous treats - can engage the retinas and, I hope, be a practical solution to some more mundane problems.</p>

<p>After setting up the out-of-the-box kit and experimenting with a few apps, I found the experience quite pleasing (and so did he). I could run a lower-intensity scene for 3am changes, psychedelic animated color progressions when he’s awake, and even have the lights sync’d up with music. I found the Hue Disco app is able to do it all, though there are many options.</p>

<p>However, one very practical problem is - when you’re carrying an infant in both hands at 3am in the dark, finding your smartphone, unlocking it, launching an app, and clicking through to start the scen you want is not very convenient. It almost makes you wish there was just a switch on the wall.</p>

<p>I wanted this to happen automatically. When I walk into the room I want the lights to just turn on. When I’m done and I leave, turn off. But how?</p>

<p><a href="https://github.com/bmantoni/pi-hue-motion">Source Code on Github</a></p>

    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-01-19T00:00:00-05:00"><a href="/blog/cordova-cli-when-using-choclatey-to-install-node/">January 19, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Bobby M">Bobby M</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/blog/cordova-cli-when-using-choclatey-to-install-node/" rel="bookmark" title="Cordova CLI when Using Choclatey to Install Node" itemprop="url">Cordova CLI when Using Choclatey to Install Node</a></h1>
    
  </header>
  <div class="entry-content">
    
      <h2 id="setting-path-for-cordova-cli-when-using-choclatey-on-windows">Setting Path for Cordova CLI when using Choclatey on Windows</h2>

<p>If you use Choclatey to install node (and then do npm install -g cordova) and try to follow the Phonegap/Cordova instructions, you’ll hit a wall when you try to run the cordova command. The problem is here:
http://docs.phonegap.com/en/edge/guide_cli_index.md.html#The%20Command-Line%20Interface
&gt; You may need to add the npm directory to your PATH in order to invoke globally installed npm modules. On Windows, npm can usually be found at C:\Users\username\AppData\Roaming\npm.</p>

<p>The reason is that choclatey doesn’t install node where it would go if you installed it directly. Rather (by default) it puts things under C:\ProgramData\choclatey</p>

<p>So if you add the above to your path, that’s not where cordova will be and you’ll get an error that the executable can’t be found.</p>

<p>So, to find the correct path, use this:
&gt; PS &gt; npm config get prefix
C:\ProgramData\chocolatey\lib\nodejs.commandline.0.10.35\tools</p>

<p>In that directory you should find a file, cordova.cmd.</p>

<p>So, add that directory to your path and you should be good to go!</p>

    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-12-02T00:00:00-05:00"><a href="/blog/unit-testing-asp-net-identity/">December 02, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Bobby M">Bobby M</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~2 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/blog/unit-testing-asp-net-identity/" rel="bookmark" title="Unit Testing ASP.NET Identity " itemprop="url">Unit Testing ASP.NET Identity </a></h1>
    
  </header>
  <div class="entry-content">
    
      <h2 id="mocking-aspnet-identity-for-web-api-and-mvc">Mocking ASP.NET Identity for Web API and MVC</h2>

<p>In the earlier days, it was quite a pain to test any built-in .NET classes, especially before the days of MVC. Even after MVC, using anything like the HTTPContext or Membership APIs directly from your Controller logic could end up making things difficult or impossible to test, since you’d be hitting concrete classes with no interfaces, static classes, or other things difficult-to-mock/stub.</p>

<p>Typically I’d end up with layers of wrappers to decouple my code and make it testable and modular. But how far things have come. </p>

<p>An example - I have a Web API ApiController that I’m using to authenticate the same username/password credentials created through MVC. This lets me share the same user management pages, persistence, password policies, etc… in both the API and web interface. When testing, I don’t want to re-test Microsoft’s code - I only want to test how my code behaves. It turns out I haven’t needed to introduce any wrappers - things are now very nearly designed to allow you to swap things in where needed.</p>

<p>First, I need a way to access the UserManager from my ApiController. Here we see another nice addition to the .NET stack: Owin. Again, it’s a nice layer between the .NET runtime/app server/modules and my own code, and can provide something like a Service Locator. I just add this property to my ApiController:</p>
<div>
  <pre><code class="c">private ApplicationUserManager _userManager;
public ApplicationUserManager UserManager
{
    get
    {
        if (_userManager == null)
        {
            _userManager = Request.GetOwinContext().GetUserManager&lt;ApplicationUserManager&gt;();
        }
        return _userManager;
    }
    set //public for tests only
    {
        _userManager = value;
    }
}</code></pre>
</div>

<p>Which relies on an extension method I add somewhere:</p>

<div>
  <pre><code class="c">public static IOwinContext GetOwinContext(this HttpRequestMessage request)
{
    var context = request.Properties[&quot;MS_HttpContext&quot;] as HttpContextWrapper;
    if (context != null)
    {
        return HttpContextBaseExtensions.GetOwinContext(context.Request);
    }
    return null;
}</code></pre>
</div>

<p>Now, to setup my tests I use this method - calling it on my controller after instantiating it. It injects a mocked ApplicationUserManager into the controller before I act on it. It prepares a valid user to be authenticated against (or not) by mocking the underlying IUserStore. Moq makes this quite elegant by offering the .As operation - which dovetails nicely with the UserManager’s discovery of interface implementations.</p>

<div>
  <pre><code class="c">private void MockUserManager(MyController c)
{
    var hpw = new PasswordHasher().HashPassword(&quot;testpass&quot;);
    var validTestUser = new ApplicationUser() { Id = &quot;1&quot;, UserName = &quot;testuser&quot;, PasswordHash = hpw };

    var us = new Mock&lt;IUserStore&lt;ApplicationUser&gt;&gt;(MockBehavior.Strict);
    us.Setup(p =&gt; p.FindByNameAsync(&quot;testuser&quot;)).ReturnsAsync(validTestUser);
    us.As&lt;IUserPasswordStore&lt;ApplicationUser&gt;&gt;()
        .Setup(p =&gt; p.GetPasswordHashAsync(It.IsAny&lt;ApplicationUser&gt;())).ReturnsAsync(hpw);
    var aum = new ApplicationUserManager(us.Object);

    c.UserManager = aum;
}</code></pre>
</div>

<p>Now, with everything arranged code my my controller like <code>var user = UserManager.Find(username, password);</code> will operate on the data loaded in the test setup. Sweet!</p>

    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->


<div class="pagination">
  
    Previous
  
  <ul class="inline-list">
    <li>
      
        <span class="current-page">1</span>
      
    </li>
    
  </ul>
  
    Next
  
</div><!-- /.pagination -->

</div><!-- /#main -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>
<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>







<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Bobby M. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://github.com/aron-bordin/neo-hpstr-jekyll-theme" rel="nofollow">Neo-HPSTR Theme</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->

</body>
</html>
